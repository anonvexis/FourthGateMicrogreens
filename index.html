<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fourth Gate Microgreens</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Inter', sans-serif;
    background-color: #F8F7F3;
    color: #2D4026;
    overflow-x: hidden;
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='4' fill='%233B7235' stroke='%23C8D7C8' stroke-width='2'/%3E%3C/svg%3E") 8 8, auto;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(12px);
    z-index: 100;
    display: none;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
}

.modal-content {
    background-color: #F8F7F3;
    padding: 2.5rem;
    border-radius: 2rem;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    position: relative;
    max-width: 550px;
    width: 90%;
    animation: slideUp 0.4s ease-out;
    border: 1px solid rgba(0,0,0,0.05);
}

.modal-close {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    font-size: 2rem;
    font-weight: 300;
    cursor: pointer;
    color: #2D4026;
}

.message-box {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 2.5rem;
    border-radius: 1.5rem;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    z-index: 101;
    display: none;
    text-align: center;
    animation: slideIn 0.3s ease-out;
}

.btn-primary {
    background-color: #3B7235;
    color: #F8F7F3;
    font-weight: 600;
    padding: 0.75rem 2rem;
    border-radius: 9999px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(59, 114, 53, 0.3);
}

.btn-primary:hover {
    background-color: #2D5829;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 114, 53, 0.4);
}

.card-selection {
    background-color: #fff;
    border: 2px solid transparent;
    border-radius: 1.5rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.card-selection:hover {
    border-color: #3B7235;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
}
.card-selection.selected {
    border-color: #3B7235;
    background-color: #F2F9F2;
    box-shadow: 0 6px 15px rgba(59, 114, 53, 0.2);
}

.qty-btn {
    background-color: #E2E8D9;
    color: #2D4026;
    font-weight: 500;
    border-radius: 9999px;
    width: 2.5rem;
    height: 2.5rem;
    transition: background-color 0.2s ease;
}
.qty-btn:hover {
    background-color: #D2DBC9;
}

.hero-headline {
    font-family: 'Playfair Display', serif;
    background: linear-gradient(120deg, #A3D9A3, #F5F5DC, #C8D7C8, #A3D9A3);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 200% auto;
    animation: text-gradient 15s linear infinite;
    font-weight: 500;
    line-height: 1.1;
}

@keyframes text-gradient {
    0% { background-position: 0% center; }
    100% { background-position: -200% center; }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
@keyframes slideIn {
    from { transform: translate(-50%, -40%); opacity: 0; }
    to { transform: translate(-50%, -50%); opacity: 1; }
}

.section-title {
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    background: linear-gradient(120deg, #3B7235, #A3A358, #E2C36D, #3B7235);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 200% auto;
    animation: text-gradient 15s linear infinite;
}

.floating {
    animation: floating 3s ease-in-out infinite;
}

@keyframes floating {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.product-card {
    background-color: #fff;
    border-radius: 1.5rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    cursor: pointer;
    overflow: hidden;
    position: relative;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
}

.product-card.selected {
    border: 3px solid #3B7235;
    box-shadow: 0 12px 25px rgba(59, 114, 53, 0.3);
}

.product-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-top-left-radius: 1.5rem;
    border-top-right-radius: 1.5rem;
}
</style>
</head>
<body class="text-stone-900">

<!-- Fixed Video Background Container -->
<div class="fixed inset-0 z-0 overflow-hidden">
    <iframe id="video-background-player"
        class="absolute top-1/2 left-1/2 min-w-full min-h-full w-[1600px] h-[900px] transform -translate-x-1/2 -translate-y-1/2 pointer-events-none"
        src="https://www.youtube.com/embed/t2yjLQ76b_I?autoplay=1&mute=1&loop=1&playlist=t2yjLQ76b_I&modestbranding=1&controls=0&showinfo=0&rel=0&enablejsapi=1"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
    ></iframe>
    <div class="absolute inset-0 bg-black/40"></div>
</div>

<!-- Navigation -->
<header class="absolute w-full z-50 px-6 py-5 flex justify-between items-center text-white">
<a href="#" class="text-3xl font-bold tracking-tighter font-['Playfair_Display']">Fourth Gate Microgreens</a>
<nav class="hidden md:flex space-x-8 font-medium">
<a href="#how-it-works" class="hover:text-amber-200 transition">How It Works</a>
<a href="#about-us" class="hover:text-amber-200 transition">About Us</a>
<a href="#subscription" class="hover:text-amber-200 transition">Plans</a>
</nav>
<button class="md:hidden p-2 rounded-lg bg-white/20 text-white">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16m-7 6h7"/>
</svg>
</button>
</header>

<!-- Hero Section -->
<section class="relative h-screen flex items-center justify-center text-center text-white overflow-hidden">
<div class="relative z-20 max-w-4xl px-6">
<h1 class="text-6xl md:text-8xl hero-headline">
Open the Gate to Health.
</h1>
<p class="mt-6 text-xl md:text-2xl font-light text-gray-200">
Nutrient-dense, farm-fresh microgreens delivered right to your door.
</p>
<div class="mt-10 flex justify-center">
<a href="#subscription" id="choose-box-btn" class="btn-primary floating">
Choose Your Box
</a>
</div>
</section>

<!-- How It Works Section -->
<section id="how-it-works" class="py-24 relative z-10 bg-[#E8F0E4]">
    <div class="max-w-6xl mx-auto px-6 text-center">
        <h2 class="text-4xl section-title">So Fresh, So Simple.</h2>
        <p class="mt-4 text-lg text-gray-800">Getting started is as easy as 1-2-3.</p>
        <div class="mt-16 relative">
            <div class="relative z-10 grid grid-cols-1 md:grid-cols-3 gap-10">
                <div class="p-10 rounded-3xl transition transform hover:scale-105 bg-white shadow-xl">
                    <div class="w-16 h-16 mx-auto flex items-center justify-center bg-green-600 text-white rounded-full mb-6 text-2xl font-bold">1</div>
                    <h3 class="text-xl font-semibold">Select Your Plan</h3>
                    <p class="mt-3 text-stone-700">Weekly or bi-weekly — tailored to your lifestyle.</p>
                </div>
                <div class="p-10 rounded-3xl transition transform hover:scale-105 bg-white shadow-xl">
                    <div class="w-16 h-16 mx-auto flex items-center justify-center bg-green-600 text-white rounded-full mb-6 text-2xl font-bold">2</div>
                    <h3 class="text-xl font-semibold">Receive Your Box</h3>
                    <p class="mt-3 text-stone-700">Harvested and delivered at peak freshness.</p>
                </div>
                <div class="p-10 rounded-3xl transition transform hover:scale-105 bg-white shadow-xl">
                    <div class="w-16 h-16 mx-auto flex items-center justify-center bg-green-600 text-white rounded-full mb-6 text-2xl font-bold">3</div>
                    <h3 class="text-xl font-semibold">Enjoy!</h3>
                    <p class="mt-3 text-stone-700">Add flavor, color, and nutrition to every meal.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Us Section -->
<section id="about-us" class="py-24 bg-white text-[#2D4026]">
    <div class="max-w-6xl mx-auto px-6 text-center md:text-left">
        <h2 class="text-4xl section-title md:text-center">Our Story</h2>
        <div class="mt-16 grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
            <div class="space-y-6">
                <p class="text-lg leading-relaxed">
                    Fourth Gate Microgreens was founded on a simple belief: everyone deserves access to the freshest, most nutrient-dense food possible. Our journey began with a small indoor farm and a passion for sustainable agriculture.
                </p>
                <p class="text-lg leading-relaxed">
                    We've perfected our craft to grow the highest quality microgreens, harvested at their peak and delivered directly to your door. We are committed to a healthier planet, using only organic, earth-friendly methods to bring the vibrant power of nature straight to your table.
                </p>
            </div>
            <div class="grid grid-cols-1 gap-6">
                <img src="https://placehold.co/600x400/F2F9F2/3B7235?text=Our+Team" alt="Our team at the farm" class="rounded-3xl shadow-xl">
                <img src="https://placehold.co/600x400/E2E8D9/2D4026?text=Our+Farm" alt="Microgreens growing indoors" class="rounded-3xl shadow-xl">
            </div>
        </div>
    </div>
</section>

<!-- Subscription CTA -->
<section id="subscription" class="py-16 bg-[#3B7235] text-white text-center">
<div class="max-w-4xl mx-auto px-6">
<h2 class="text-4xl font-bold font-['Playfair_Display']">Ready to Start Your Journey?</h2>
<p class="mt-4 text-lg font-light text-green-100">Choose your subscription plan and experience greens like never before.</p>
<div class="mt-6 flex justify-center">
<button id="view-plans-btn" class="bg-white text-[#2D4026] font-semibold py-3 px-10 rounded-full shadow-xl hover:bg-gray-100 transition transform hover:scale-105">
View Our Plans
</button>
</div>
</section>

<!-- Footer -->
<footer class="bg-[#2D4026] text-gray-400 py-10 text-center">
<p>&copy; 2024 Fourth Gate Microgreens. All rights reserved.</p>
</footer>

<!-- Subscription Modal -->
<div id="subscription-modal" class="modal-overlay">
    <div class="modal-content text-[#2D4026]">
        <span class="modal-close" onclick="closeModal()">&times;</span>

        <!-- Step 1: Choose Custom or Preset -->
        <div id="step-1" class="step-content">
            <h3 class="text-2xl font-bold text-center mb-6">Choose Your Box</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="product-card" onclick="goToPresets()">
                    <img src="https://placehold.co/550x300/F2F9F2/3B7235?text=Preset+Blends" alt="Preset Blends" class="product-image">
                    <div class="p-6 text-center">
                        <h4 class="font-bold text-xl mb-1">Choose a Preset</h4>
                        <p class="text-sm text-gray-500">Curated for flavor and health</p>
                    </div>
                </div>
                <div class="product-card" onclick="goToCustom()">
                    <img src="https://placehold.co/550x300/E2E8D9/2D4026?text=Build+Your+Own" alt="Build Your Own" class="product-image">
                    <div class="p-6 text-center">
                        <h4 class="font-bold text-xl mb-1">Build Your Own</h4>
                        <p class="text-sm text-gray-500">Perfectly tailored to you</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Choose Preset -->
        <div id="step-2" class="step-content hidden">
            <h3 class="text-2xl font-bold text-center mb-6">Select a Preset</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="product-card" onclick="selectCard(this)" data-preset="Zesty Boost" data-price="18">
                    <img src="https://placehold.co/550x200/F2F9F2/3B7235?text=Zesty+Boost" alt="Zesty Boost" class="product-image">
                    <div class="p-4">
                        <h4 class="font-bold text-xl">The Zesty Boost</h4>
                        <p class="text-sm mt-1 text-gray-500">Broccoli & Radish</p>
                        <p class="mt-2 text-lg font-semibold">$18</p>
                    </div>
                </div>
                <div class="product-card" onclick="selectCard(this)" data-preset="Wellness Blend" data-price="18">
                    <img src="https://placehold.co/550x200/F2F9F2/3B7235?text=Wellness+Blend" alt="Wellness Blend" class="product-image">
                    <div class="p-4">
                        <h4 class="font-bold text-xl">The Wellness Blend</h4>
                        <p class="text-sm mt-1 text-gray-500">Kale & Broccoli</p>
                        <p class="mt-2 text-lg font-semibold">$18</p>
                    </div>
                </div>
                <div class="product-card" onclick="selectCard(this)" data-preset="Garden Party" data-price="18">
                    <img src="https://placehold.co/550x200/F2F9F2/3B7235?text=Garden+Party" alt="Garden Party" class="product-image">
                    <div class="p-4">
                        <h4 class="font-bold text-xl">The Garden Party</h4>
                        <p class="text-sm mt-1 text-gray-500">Sunflower & Pea</p>
                        <p class="mt-2 text-lg font-semibold">$18</p>
                    </div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <button class="w-full btn-primary" onclick="goToSubscriptionFrequency()">
                    Proceed
                </button>
            </div>
            <button class="mt-6 text-gray-500 hover:text-gray-700 transition" onclick="prevStep()">← Back</button>
        </div>

        <!-- Step 2a: Choose Subscription Frequency -->
        <div id="step-2a" class="step-content hidden">
            <h3 class="text-2xl font-bold text-center mb-6">Choose Frequency</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="card-selection" onclick="selectCard(this)" data-frequency="Weekly" data-price-modifier="1">
                    <h4 class="font-bold text-xl">Weekly</h4>
                    <p class="text-sm mt-1 text-gray-500">Best for daily use</p>
                </div>
                <div class="card-selection" onclick="selectCard(this)" data-frequency="Bi-weekly" data-price-modifier="0.95">
                    <h4 class="font-bold text-xl">Bi-weekly</h4>
                    <p class="text-sm mt-1 text-gray-500">Save 5%</p>
                </div>
                <div class="card-selection" onclick="selectCard(this)" data-frequency="Monthly" data-price-modifier="0.9">
                    <h4 class="font-bold text-xl">Monthly</h4>
                    <p class="text-sm mt-1 text-gray-500">Save 10%</p>
                </div>
            </div>
            <div class="mt-6 text-2xl font-bold text-center text-[#2D4026]">
                Total: $<span id="frequency-total-price">0.00</span>
            </div>
            <div class="mt-6 text-center">
                <button class="w-full btn-primary" onclick="goToDetailsFromFrequency()">
                    Proceed to Details
                </button>
            </div>
            <button class="mt-6 text-gray-500 hover:text-gray-700 transition" onclick="prevStep()">← Back</button>
        </div>

        <!-- Step 3: Build Your Custom Box -->
        <div id="step-3" class="step-content hidden">
            <h3 class="text-2xl font-bold text-center mb-6">Build Your Box</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-md">
                    <p class="font-semibold text-lg mb-2 text-center">Crop 1</p>
                    <div id="crop1-options" class="flex flex-wrap gap-2 justify-center">
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Broccoli">Broccoli</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Kale">Kale</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Radish">Radish</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Sunflower">Sunflower</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Pea">Pea</div>
                    </div>
                    <div class="mt-4 flex gap-4 items-center justify-center">
                        <span class="text-gray-500">3.5 oz</span>
                        <div class="flex items-center gap-2">
                            <button class="qty-btn" onclick="handleQtyChange(event, 'decrease', 'crop1-qty')">-</button>
                            <span id="crop1-qty" class="font-bold text-lg">1</span>
                            <button class="qty-btn" onclick="handleQtyChange(event, 'increase', 'crop1-qty')">+</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-md">
                    <p class="font-semibold text-lg mb-2 text-center">Crop 2</p>
                    <div id="crop2-options" class="flex flex-wrap gap-2 justify-center">
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Broccoli">Broccoli</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Kale">Kale</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Radish">Radish</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Sunflower">Sunflower</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Pea">Pea</div>
                    </div>
                    <div class="mt-4 flex gap-4 items-center justify-center">
                        <span class="text-gray-500">3.5 oz</span>
                        <div class="flex items-center gap-2">
                            <button class="qty-btn" onclick="handleQtyChange(event, 'decrease', 'crop2-qty')">-</button>
                            <span id="crop2-qty" class="font-bold text-lg">1</span>
                            <button class="qty-btn" onclick="handleQtyChange(event, 'increase', 'crop2-qty')">+</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-md">
                    <p class="font-semibold text-lg mb-2 text-center">Crop 3</p>
                    <div id="crop3-options" class="flex flex-wrap gap-2 justify-center">
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Broccoli">Broccoli</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Kale">Kale</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Radish">Radish</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Sunflower">Sunflower</div>
                        <div class="card-selection" onclick="selectCard(this)" data-crop="Pea">Pea</div>
                    </div>
                    <div class="mt-4 flex gap-4 items-center justify-center">
                        <span class="text-gray-500">3.5 oz</span>
                        <div class="flex items-center gap-2">
                            <button class="qty-btn" onclick="handleQtyChange(event, 'decrease', 'crop3-qty')">-</button>
                            <span id="crop3-qty" class="font-bold text-lg">1</span>
                            <button class="qty-btn" onclick="handleQtyChange(event, 'increase', 'crop3-qty')">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-2xl font-bold text-center text-[#2D4026]">
                Total: $<span id="total-price">0.00</span>
            </div>
            <button class="w-full btn-primary mt-6" onclick="goToDetailsFromCustom()">
                Proceed to Details
            </button>
            <button class="mt-6 text-gray-500 hover:text-gray-700 transition" onclick="prevStep()">← Back</button>
        </div>

        <!-- Step 4: Enter Details -->
        <div id="step-4" class="step-content hidden">
            <h3 class="text-2xl font-bold text-center mb-6">Enter Your Details</h3>
            <form id="details-form">
                <input type="text" placeholder="Full Name" class="w-full p-3 mb-4 rounded-lg border-2 border-gray-300 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#3B7235]" required>
                <input type="email" placeholder="Email Address" class="w-full p-3 mb-4 rounded-lg border-2 border-gray-300 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#3B7235]" required>
                <input type="text" placeholder="Shipping Address" class="w-full p-3 mb-4 rounded-lg border-2 border-gray-300 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#3B7235]" required>
                <button type="submit" class="w-full btn-primary">
                    Complete Order
                </button>
            </form>
            <button class="mt-6 text-gray-500 hover:text-gray-700 transition" onclick="prevStep()">← Back</button>
        </div>
    </div>
</div>

<!-- Message Box -->
<div id="message-box" class="message-box">
<p id="message-text" class="text-lg font-semibold text-stone-800"></p>
<button class="mt-4 bg-[#3B7235] text-white font-semibold py-2 px-6 rounded-full" onclick="closeMessageBox()">OK</button>
</div>

<!-- YouTube IFrame Player API -->
<script src="https://www.youtube.com/iframe_api"></script>
<script>
// --- Video Looping Logic ---
var player;
var checkInterval;
var loopStart = 90; // Video start time in seconds

// This function is automatically called by the YouTube API
function onYouTubeIframeAPIReady() {
    player = new YT.Player('video-background-player', {
        events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerReady(event) {
    event.target.playVideo();
    event.target.seekTo(loopStart);
}

function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.PLAYING) {
        // Start the check interval only when the video is playing
        checkInterval = setInterval(function() {
            var currentTime = player.getCurrentTime();
            var duration = player.getDuration();
            var loopEnd = duration - 30; // 30 seconds before the end
            if (currentTime >= loopEnd) {
                player.seekTo(loopStart);
            }
        }, 500); // Check every half second
    } else {
        clearInterval(checkInterval);
    }
}

// --- Modal & Pricing Logic ---
const modal = document.getElementById('subscription-modal');
const chooseBoxBtn = document.getElementById('choose-box-btn');
const viewPlansBtn = document.getElementById('view-plans-btn');
const detailsForm = document.getElementById('details-form');
const messageBox = document.getElementById('message-box');
const messageText = document.getElementById('message-text');
const totalPriceEl = document.getElementById('total-price');

let currentStep = 1;
const pricePerUnit = 6;
let isCustomOrder = true;
let selectedPreset = null;
let selectedFrequency = null;

function showMessageBox(message) {
    messageText.textContent = message;
    messageBox.style.display = 'block';
}

function closeMessageBox() {
    messageBox.style.display = 'none';
}

function openModal() {
    modal.style.display = 'flex';
    currentStep = 1;
    showStep(currentStep);
    updatePrice();
}

function closeModal() {
    modal.style.display = 'none';
}

function showStep(step) {
    currentStep = step;
    const steps = document.querySelectorAll('.step-content');
    steps.forEach(s => s.classList.add('hidden'));
    document.getElementById('step-' + step).classList.remove('hidden');
}

function selectCard(card) {
    const parent = card.parentElement;
    parent.querySelectorAll('.card-selection, .product-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    updatePrice();
}

function goToPresets() {
    isCustomOrder = false;
    showStep(2);
}

function goToCustom() {
    isCustomOrder = true;
    showStep(3);
    updatePrice();
}

function goToSubscriptionFrequency() {
    const presetCard = document.querySelector('#step-2 .product-card.selected');
    if (!presetCard) {
        showMessageBox('Please select a preset to continue.');
        return;
    }
    selectedPreset = {
        name: presetCard.dataset.preset,
        price: parseFloat(presetCard.dataset.price),
    };
    updatePrice();
    showStep('2a');
}

function goToDetailsFromFrequency() {
    const frequencyCard = document.querySelector('#step-2a .card-selection.selected');
    if (!frequencyCard) {
        showMessageBox('Please select a subscription frequency.');
        return;
    }
    selectedFrequency = frequencyCard.dataset.frequency;
    showStep(4);
}

function goToDetailsFromCustom() {
    const crop1Selected = document.querySelector('#crop1-options .selected');
    const crop2Selected = document.querySelector('#crop2-options .selected');
    const crop3Selected = document.querySelector('#crop3-options .selected');
    if (!crop1Selected && !crop2Selected && !crop3Selected) {
        showMessageBox('Please select at least one crop to proceed.');
        return;
    }
    showStep(4);
}

function prevStep() {
    if (currentStep === 4) {
        if (isCustomOrder) {
            showStep(3);
        } else {
            showStep('2a');
        }
    } else if (currentStep === '2a') {
        showStep(2);
    } else if (currentStep === 3 || currentStep === 2) {
        showStep(1);
    }
}

function updatePrice() {
    let total = 0;
    let priceElementId = 'total-price';

    if (isCustomOrder) {
        const crop1Selected = document.querySelector('#crop1-options .selected');
        const crop2Selected = document.querySelector('#crop2-options .selected');
        const crop3Selected = document.querySelector('#crop3-options .selected');

        const crop1Qty = parseInt(document.getElementById('crop1-qty').textContent) || 0;
        const crop2Qty = parseInt(document.getElementById('crop2-qty').textContent) || 0;
        const crop3Qty = parseInt(document.getElementById('crop3-qty').textContent) || 0;

        if (crop1Selected) total += crop1Qty * pricePerUnit;
        if (crop2Selected) total += crop2Qty * pricePerUnit;
        if (crop3Selected) total += crop3Qty * pricePerUnit;
    } else {
        if (selectedPreset) {
            total = selectedPreset.price;
            priceElementId = 'frequency-total-price';
        }
    }

    const frequencySelected = document.querySelector('#step-2a .card-selection.selected');
    if (frequencySelected) {
        const modifier = parseFloat(frequencySelected.dataset.priceModifier);
        total *= modifier;
    }

    if(document.getElementById(priceElementId)) {
        document.getElementById(priceElementId).textContent = total.toFixed(2);
    }
}

function handleQtyChange(e, action, id) {
    e.stopPropagation();
    const currentQtyEl = document.getElementById(id);
    let currentQty = parseInt(currentQtyEl.textContent);
    
    if (action === 'increase') {
        currentQty++;
    } else if (action === 'decrease' && currentQty > 0) {
        currentQty--;
    }
    
    currentQtyEl.textContent = currentQty;
    updatePrice();
}

detailsForm.addEventListener('submit', function(event) {
    event.preventDefault();
    showMessageBox('Thank you for your order! We\'ll send a confirmation to your email shortly.');
    closeModal();
    console.log('Form submitted.');
});

chooseBoxBtn.addEventListener('click', function(e) {
    e.preventDefault();
    openModal();
});
viewPlansBtn.addEventListener('click', function(e) {
    e.preventDefault();
    openModal();
});
</script>

</body>
</html>
